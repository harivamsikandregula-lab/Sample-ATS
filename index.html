<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResuMax AI | Resume Score Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        :root { --primary: #4f46e5; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .view-section { display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; }
        .view-section.active { display: block; opacity: 1; transform: translateY(0); }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05); }
        .score-ring { transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1); }
        /* Style for Markdown content */
        .markdown-body h1 { font-weight: 800; font-size: 1.5rem; margin-bottom: 1rem; color: #1e293b; }
        .markdown-body h2 { font-weight: 700; font-size: 1.25rem; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #4f46e5; }
        .markdown-body ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .markdown-body li { margin-bottom: 0.5rem; color: #475569; }
        .markdown-body strong { color: #1e293b; }
    </style>
</head>
<body class="text-slate-900">
    <nav class="fixed top-0 w-full z-50 bg-white/70 backdrop-blur-xl border-b border-slate-200/60">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showView('view-landing')">
                <div class="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg"><i data-lucide="zap" class="text-white w-5 h-5 fill-current"></i></div>
                <span class="text-lg font-bold tracking-tight">Resu<span class="text-indigo-600">Max</span></span>
            </div>
        </div>
    </nav>

    <main class="pt-24 min-h-screen pb-20">
        <section id="view-landing" class="view-section active max-w-4xl mx-auto px-6 py-20 text-center">
            <h1 class="text-5xl md:text-7xl font-extrabold mb-6 tracking-tight">Check Your <span class="text-indigo-600">Resume Score</span></h1>
            <p class="text-xl text-slate-500 mb-10 max-w-xl mx-auto">Get an instant score and expert suggestions to improve your resume impact.</p>
            <button onclick="showView('view-upload')" class="px-10 py-4 bg-indigo-600 text-white rounded-2xl font-bold text-lg shadow-xl shadow-indigo-200 hover:bg-indigo-700 transition-all">Upload Now</button>
        </section>

        <section id="view-upload" class="view-section max-w-xl mx-auto px-6">
            <div class="glass-card p-8 rounded-3xl border border-slate-200">
                <div id="drop-zone" class="h-64 border-2 border-dashed border-slate-300 rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:border-indigo-400 transition-all bg-white">
                    <input type="file" id="resume-input" class="hidden" accept=".pdf">
                    <i data-lucide="upload" class="w-10 h-10 text-indigo-600 mb-4"></i>
                    <p class="font-bold">Click to upload Resume (PDF)</p>
                    <div id="file-name" class="hidden mt-4 text-indigo-600 font-bold bg-indigo-50 px-4 py-2 rounded-full text-sm"></div>
                </div>
                <button id="start-btn" onclick="startAnalysis()" class="w-full mt-8 py-4 bg-indigo-600 text-white rounded-2xl font-bold opacity-50 cursor-not-allowed" disabled>Analyze Resume</button>
            </div>
        </section>

        <section id="view-loading" class="view-section py-20 text-center">
            <div class="w-20 h-20 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h2 class="text-2xl font-bold">Calculating Score...</h2>
        </section>

        <section id="view-results" class="view-section max-w-5xl mx-auto px-6">
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="glass-card p-8 rounded-3xl text-center">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-6">Your Score</h3>
                        <div class="relative inline-flex items-center justify-center mb-6">
                            <svg class="w-40 h-40 transform -rotate-90">
                                <circle cx="80" cy="80" r="72" stroke="#f1f5f9" stroke-width="10" fill="transparent" />
                                <circle id="score-ring" cx="80" cy="80" r="72" stroke="#4f46e5" stroke-width="10" fill="transparent" stroke-dasharray="452" stroke-dashoffset="452" class="score-ring" stroke-linecap="round" />
                            </svg>
                            <span id="score-text" class="absolute text-5xl font-black">0</span>
                        </div>
                        <div id="score-label" class="py-2 px-4 rounded-full text-xs font-bold inline-block"></div>
                    </div>
                </div>
                <div class="lg:col-span-2">
                    <div class="glass-card p-8 rounded-3xl">
                        <div id="analysis-content" class="markdown-body text-slate-600"></div>
                        <button onclick="showView('view-upload')" class="mt-8 flex items-center gap-2 text-indigo-600 font-bold hover:underline">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> Try Another
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        const dropZone = document.getElementById('drop-zone');
        const resumeInput = document.getElementById('resume-input');
        const startBtn = document.getElementById('start-btn');
        const fileNameDiv = document.getElementById('file-name');
        let file = null;

        dropZone.onclick = () => resumeInput.click();
        resumeInput.onchange = (e) => {
            if (e.target.files.length) {
                file = e.target.files[0];
                fileNameDiv.textContent = file.name;
                fileNameDiv.classList.remove('hidden');
                startBtn.disabled = false;
                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        };

        async function startAnalysis() {
            showView('view-loading');
            const formData = new FormData();
            formData.append('resume', file);

            try {
                const res = await fetch('/analyze', { method: 'POST', body: formData });
                const data = await res.json();
                if (data.status === 'success') {
                    // Render Markdown to HTML
                    document.getElementById('analysis-content').innerHTML = marked.parse(data.analysis);
                    showView('view-results');
                    animateScore(data.score);
                } else {
                    alert(data.error);
                    showView('view-upload');
                }
            } catch (e) {
                alert('Server connection failed.');
                showView('view-upload');
            }
        }

        function animateScore(target) {
            const ring = document.getElementById('score-ring');
            const text = document.getElementById('score-text');
            const label = document.getElementById('score-label');
            const circumference = 452;
            ring.style.strokeDashoffset = circumference - (target / 100) * circumference;

            let curr = 0;
            const step = () => {
                if (curr < target) {
                    curr++;
                    text.textContent = curr;
                    requestAnimationFrame(step);
                }
            };
            requestAnimationFrame(step);

            if (target >= 80) { label.textContent = 'EXCELLENT'; label.className = 'py-2 px-4 rounded-full text-xs font-bold inline-block bg-emerald-100 text-emerald-700'; }
            else if (target >= 60) { label.textContent = 'GOOD'; label.className = 'py-2 px-4 rounded-full text-xs font-bold inline-block bg-amber-100 text-amber-700'; }
            else { label.textContent = 'NEEDS WORK'; label.className = 'py-2 px-4 rounded-full text-xs font-bold inline-block bg-rose-100 text-rose-700'; }
        }

        lucide.createIcons();
    </script>
</body>
</html>
